# 编写预安装脚本<a name="ZH-CN_TOPIC_0187280635"></a>

您可以在解析 kickstart 文件后、开始安装前添加要在该系运行执行的命令。这个部分必须处于 kickstart 文件的最后，而且必须用 %pre 命令开头，以 %end 结尾。

>![](public_sys-resources/icon-note.gif) **说明：**   
>如果您的 kickstart 文件还包括 %post 部分，%pre 和 %post 的顺序是没有关系的。  

## 脚本说明<a name="zh-cn_topic_0151920824_s701b509b5d864ef78dd9d097eb333e3a"></a>

kickstart 文件的预安装脚本部分无法管理多个安装源。这个信息必须包含在创建的每个 kickstart 文件中，因为是在安装程序的第二阶段才运行预安装脚本。

可在预安装脚本中使用以下选项来改变安装行为。要使用这些选项，请将其添加到该脚本开始的 %pre 行。例如：

```
%pre --interpreter=/usr/bin/python
--- Python script omitted --
%end
```

-   --interpreter=

    允许指定不同的脚本语言，如 Python。可使用该系统中可用的任意脚本语言。在大多数情况下是 /usr/bin/sh、/usr/bin/bash 和 /usr/bin/python。例如：

    ```
    %post --interpreter=/usr/bin/python
    ```

-   --erroronfail

    如果脚本失败则显示出错信息并暂停安装。该出错信息可让您进入记录失败原因的位置。例如：

    ```
    %post --log=/mnt/sysimage/root/anaconda-post.log --erroronfail
    ```

-   --log=

    在指定日志文件中记录该脚本的输出结果。例如：

    ```
    %post --log=/mnt/sysimage/root/ks-pre.log
    ```


## 应用示例<a name="zh-cn_topic_0151920824_s5d04e48df13744f997b7e3a06c34c57a"></a>

以下是 %pre 部分的示例：

```
%pre
#!/bin/sh  
hds="" 
mymedia=""  
for file in /proc/ide/h* do   
mymedia=`cat $file/media`   
if [ $mymedia == "disk" ] ; then       
hds="$hds `basename $file`"   
fi 
done  
set $hds 
numhd=`echo $#`  
drive1=`echo $hds | cut -d' ' -f1` 
drive2=`echo $hds | cut -d' ' -f2`  

#Write out partition scheme based on whether there are 1 or 2 hard drives  
if [ $numhd == "2" ] ; then   
#2 drives   
echo "#partitioning scheme generated in %pre for 2 drives" > /tmp/part-include   
echo "clearpart --all" >> /tmp/part-include   
echo "part /boot --fstype ext4 --size 75 --ondisk hda" >> /tmp/part-include  
echo "part /boot/efi --fstype efi --size 50 --ondisk hda" >> /tmp/part-include
echo "part / --fstype ext4 --size 1 --grow --ondisk hda" >> /tmp/part-include   
echo "part swap --recommended --ondisk $drive1" >> /tmp/part-include   
echo "part /home --fstype ext4 --size 1 --grow --ondisk hdb" >> /tmp/part-include 
else   
#1 drive   
echo "#partitioning scheme generated in %pre for 1 drive" > /tmp/part-include   
echo "clearpart --all" >> /tmp/part-include   
echo "part /boot --fstype ext4 --size 75" >> /tmp/part-include
echo "part /boot/efi --fstype efi --size 50 --ondisk hda" >> /tmp/part-include
echo "part swap --recommended" >> /tmp/part-include   
echo "part / --fstype ext4 --size 2048" >> /tmp/part-include   
echo "part /home --fstype ext4 --size 2048 --grow" >> /tmp/part-include 
fi
%end
```

该脚本决定系统中的硬盘驱动器数量，并根据系统中有一个还是两个驱动器而编写带有不同分区方案的文本文件。

