# 为安全容器配置存储<a name="ZH-CN_TOPIC_0184808180"></a>

安全容器支持SFS和OBS两种远端存储。

1.  SFS远端存储方式

    启动一个带NFS远端存储的容器：

    ```
    docker run -tid --runtime kata-runtime --network none 
    --annotation com.github.containers.virtcontainers.storage_spec="[{\"storage_type\":\"nfs\",\"source\":\"sfs.com:/remote/path\",\"dest\":\"/opt/nfs\"}]" <container-image>  bash
    ```

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >当远端类型为nfs时，options参数暂时没有使用。  

2.  OBS远端存储方式

    -   启动一个pause容器。

    -   创建业务容器A（sidecar容器），需要SYS\_ADMIN权限。

        ```
        docker run -tid --runtime kata-runtime --network none 
        --annotation com.github.containers.virtcontainers.storage_spec="[{\"storage_type\":\"gpath\",\"source\":\"/path/in/vm\",\"dest\":\"/path/in/containerA\",\"options\":{\"custom_op\":[\"shared\"],\"mount_op\":[\"shared\"]}}]" bash
        ```


    -   创建业务容器B，使用容器A创建子目录。

        ```
        docker run -tid --runtime kata-runtime --network none --annotation io.kubernetes.docker.type=container 
        --annotation io.kubernetes.sandbox.id=046ccf8b516686b72ed1186992ba99d15cf6779cd82f3cfa3e0c6cf95f778f7e 
        --annotation com.github.containers.virtcontainers.storage_spec="[{\"storage_type\":\"gpath\",\"source\":\"/path/in/vm/subpath\",\"dest\":\"/path/in/containerB\",\"options\":{\"custom_op\":[\"mounted\"]}}]"  b0f6bcd0a2a0 bash
        ```


    >![](public_sys-resources/icon-note.gif) **说明：**   
    >-   挂载远端OBS存储的sidecar容器需要增加SYS\_ADMIN权限，且需要指定mount\_op为shared。  
    >-   通过options里custom\_op的mounted字段来说明是挂载远端OBS存储，还是使用既有目录。  

    远端存储配置命令行接口说明见下表：

    <a name="zh-cn_topic_0182219837_table982494095013"></a>
    <table><thead align="left"><tr id="zh-cn_topic_0182219837_row1882410402508"><th class="cellrowborder" valign="top" width="26.61%" id="mcps1.1.4.1.1"><p id="zh-cn_topic_0182219837_p11824940105019"><a name="zh-cn_topic_0182219837_p11824940105019"></a><a name="zh-cn_topic_0182219837_p11824940105019"></a><strong id="zh-cn_topic_0182219837_b164621449925"><a name="zh-cn_topic_0182219837_b164621449925"></a><a name="zh-cn_topic_0182219837_b164621449925"></a>接口</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="19.33%" id="mcps1.1.4.1.2"><p id="zh-cn_topic_0182219837_p19542161812217"><a name="zh-cn_topic_0182219837_p19542161812217"></a><a name="zh-cn_topic_0182219837_p19542161812217"></a><strong id="zh-cn_topic_0182219837_b129808431828"><a name="zh-cn_topic_0182219837_b129808431828"></a><a name="zh-cn_topic_0182219837_b129808431828"></a>参数（隶属于docker命令</strong>）</p>
    </th>
    <th class="cellrowborder" valign="top" width="54.059999999999995%" id="mcps1.1.4.1.3"><p id="zh-cn_topic_0182219837_p2824740135011"><a name="zh-cn_topic_0182219837_p2824740135011"></a><a name="zh-cn_topic_0182219837_p2824740135011"></a><strong id="zh-cn_topic_0182219837_b626218521324"><a name="zh-cn_topic_0182219837_b626218521324"></a><a name="zh-cn_topic_0182219837_b626218521324"></a>使用说明</strong></p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="zh-cn_topic_0182219837_row582424095017"><td class="cellrowborder" valign="top" width="26.61%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0182219837_p73363271365"><a name="zh-cn_topic_0182219837_p73363271365"></a><a name="zh-cn_topic_0182219837_p73363271365"></a>--annotation  com.github.containers.virtcontainers.storage_spec</p>
    </td>
    <td class="cellrowborder" valign="top" width="19.33%" headers="mcps1.1.4.1.2 "><a name="zh-cn_topic_0182219837_ul9447823151720"></a><a name="zh-cn_topic_0182219837_ul9447823151720"></a><ul id="zh-cn_topic_0182219837_ul9447823151720"><li>docker create</li><li>docker run</li></ul>
    </td>
    <td class="cellrowborder" valign="top" width="54.059999999999995%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0182219837_p15487886720"><a name="zh-cn_topic_0182219837_p15487886720"></a><a name="zh-cn_topic_0182219837_p15487886720"></a>annotation的value为以下数据结构对应的json文本：</p>
    <pre class="screen" id="zh-cn_topic_0182219837_screen748716816711"><a name="zh-cn_topic_0182219837_screen748716816711"></a><a name="zh-cn_topic_0182219837_screen748716816711"></a>type StorageSpec struct {       
    StorageType string`json:"storage_type,omitempty"`        Source      string `json:"source,omitempty"`        Destination string `json:"dest,omitempty"`         
    Options map[string][]string `json:"options,omitempty"` 
    }</pre>
    <p id="zh-cn_topic_0182219837_p6328509919"><a name="zh-cn_topic_0182219837_p6328509919"></a><a name="zh-cn_topic_0182219837_p6328509919"></a>该annotation支持2种类型远端存储：</p>
    <a name="zh-cn_topic_0182219837_ul93281208916"></a><a name="zh-cn_topic_0182219837_ul93281208916"></a><ul id="zh-cn_topic_0182219837_ul93281208916"><li>SFS/SFS-turbo：类型名为nfs。</li><li>OBS：类型名为gpath。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>


