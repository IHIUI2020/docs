# 动态链接库<a name="ZH-CN_TOPIC_0229243620"></a>

使用-shared选项 和-fPIC选项，可直接使用源文件、汇编文件或者目标文件创建一个动态库。其中-fPIC 选项作用于编译阶段，在生成目标文件时就需要使用该选项，以生成位置无关的代码。

示例1：从源文件生成动态链接库。

```
gcc -fPIC -shared test.c -o libtest.so
```

示例2：从目标文件生成动态链接库。

```
gcc -fPIC -c test.c -o test.o
gcc -shared test.o -o libtest.so
```

将一个动态库链接到可执行文件，需要在命令行中列出动态库的名称。

示例：将main.c和libtest.so一起编译成 app.out，当 app.out 运行时，会动态地加载链接库 libtest.so。

```
gcc main.c libtest.so -o app.out
```

这种方式是直接指定使用当前目录下的libtest.so文件。

若使用下面搜索动态库的方式，则为了确保程序在运行时能够链接到动态库，需要通过如下三种方法中的任一种实现。

-   将动态库保存在标准目录下，例如 /usr/lib。
-   把动态库所在路径libaryDIR增加到环境变量LD\_LIBRARY\_PATH中

    export LD\_LIBRARY\_PATH=libraryDIR:$LD\_LIBRARY\_PATH

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >LD\_LIBRARY\_PATH为动态库的环境变量。当运行动态库时，若动态库不在缺省文件夹（/lib 和/usr/lib）下，则需要指定环境变量LD\_LIBRARY\_PATH。  

-   把动态库所在路径libaryDIR增加 /etc/ld.so.conf中然后执行ldconfig或者以动态库所在路径libaryDIR为参数执行ldconfig。

```
gcc main.c -L libraryDIR -ltest -o app.out
export LD_LIBRARY_PATH=libraryDIR:$LD_LIBRARY_PATH
```

